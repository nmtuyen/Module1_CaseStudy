<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Main_game</title>
    <script src="food.js"></script>
    <script src="snake.js"></script>
    <script src="stone.js"></script>
</head>
<body>
Score:<input id="score"/><br/>
<canvas id="mycanvas" width="250" height="300" style="border: 1px solid #05041a; background-image: url('background.png')"></canvas>
<canvas id="score_player" width="100" height="300" style="border: 1px solid #05041a"></canvas>
<img style="display: none" id="left" src="head_left.jpg" height="10" width="10"/>
<img style="display: none" id="right" src="head_right.jpg" height="10" width="10"/>
<img style="display: none" id="up" src="head_up.jpg" height="10" width="10"/>
<img style="display: none" id="down" src="head_down .jpg" height="10" width="10"/>

<script>
    let snake = new Snake(50, 50, 'red', 10, 10);
    let food = new Food();
    let stone = new Stone();
    let score = 0;
    let c = document.getElementById('mycanvas');
    food.draw_food(c);
    snake.draw(c);
    stone.draw(c);
    let stones = [stone];

    function createStone() {
        if(stones.length > 10)
            return;
        let stone = new Stone();
        stones.push(stone);
    }

    function moveSnake(evt) {
        switch (evt.keyCode) {
            case 37:
                // alert('trái')
                if (snake.start === 'right')
                    break;
                snake.start = 'left';
                break;
            case 39:
                // alert("phải")
                if (snake.start === 'left')
                    break;
                snake.start = 'right';
                break;
            case 38:
                // alert("lên")
                if (snake.start === 'down')
                    break;
                snake.start = 'up';
                break;
            case 40:
                // alert("xuống")
                if (snake.start === 'up')
                    break;
                snake.start = 'down';
                break;
        }
    }
    function caculator_score() {
        if (snake.x === food.x && snake.y === food.y){
            score +=1;

        }
        document.getElementById("score").value = score;
    }
    function eatfood() {
        if (snake.x === food.x && snake.y === food.y){
            snake.legthsnake ++;
            score++
            food.change_pos();
            while(true){
                let flag = false;
                for (let i = 0; i < stones.length; i++) {
                    if(food.x === stones[i].x && food.y === stones[i].y){
                        food.change_pos();
                        flag = true;
                    }
                }
                if(!flag){
                    break;
                }
            }
            createStone();
        }
    }
    function clear() {
        let ctx = c.getContext('2d');
        ctx.clearRect(0,0, 500, 600);
    }
    function endGame() {
        let life = true;
        for (i = 0; i < stones[i]; i++) {
            if (snake.x === stones[i].x && snake.y === stones[i].y) {
                return life = false;
            }

        }
        if (life === false)
            window.location.href = 'endGame.html'
    }

        function runGame() {

            clear();
            caculator_score()
            snake.move();
            snake.draw(c);
            for (let i = 0; i < stones.length; i++) {
                stones[i].draw(c);
            }
            food.draw_food(c);
            eatfood();
            snake.check();
            snake.update();
            for (i = 0; i < stones.length; i++){
                if (snake.x === stones[i].x && snake.y === stones[i].y)
                    endGame();
                console.log(snake.x,stones[i].x,snake.y, stones[i].y)
            }
        }


        setInterval(runGame, 150);

        window.addEventListener('keydown', moveSnake);
        window.addEventListener('keypress', moveSnake);
        window.addEventListener('keyup', moveSnake);
</script>


</body>
</html>